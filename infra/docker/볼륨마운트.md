# 컨테이너 볼륨 마운트

볼륨이란 스토리지의 한 영역을 분할한 것



리눅스에서 디스크를 파티셔닝하고 볼륨을 지정한 것과 유사



컨테이너는 외부에 있는 데이터를 다룰 수 없음

외부 데이터를 다룰려면 볼륨 마운트를 해줘야 한다.



컨테이너 내부 안에 데이터는 컨테이너가 삭제되면 같이 삭제된다.

컨테이너는 생성과 삭제가 잦은데 이럴 때마다 데이터를 옮기기는 번거롭다.

그렇기에 매번 데이터를 옮기기보다는 처음부터 컨테이너 외부에 둔 데이터에 접근해 사용하는 것이 일반적이다.

이를 데이터 퍼시스턴시(data persistency)라고 한다.



이때 데이터를 두는 장소가 마운트된 스토리지 영역이다.

스토리지 마운트 (보통 볼륨 마운트라함)

마운트 대상이 되는 스토리지는 볼륨 외에도 디렉토리나 파일, 메모리가 될 수도 있음



# 스토리지 마운트 종류

## 볼륨 마운트

볼륨 마운트는 <u>도커 엔진이 관리하는 영역 내</u>에 만들어진 볼륨을 컨테이너에 디스크 형태로 마운트함

이름으로 관리하기에 다루기는 쉬움.

볼륨에 비해 직접 조작하기 어려우므로 **임시 목적의 사용**이나 **자주 쓰지는 않지만 지우면 안되는 파일**을 두는 목적으로 많이 사용한다.





## 바인드 마운트

도커 엔진이 관리하는 영역이 아닌 도커가 설치된 로컬 서버의 디렉토리 영역을 컨테이너에 마운트하는 방식

디렉토리가 아닌 파일 단위로도 마운트가 가능하다.



디렉토리 속에 파일을 직접 두거나 열어볼 수 있기 때문에 자주 사용하는 파일을 두는 데 사용한다.





## 임시 메모리 마운트

tmpfs 마운트 (temporary file system mount)

임시 메모리에 마운트하는 방식 (메모리 영역)

디스크 마운트방식보단 훨씬 I/O가 빠르나, 도커 엔진이 정지하거나 호스트가 재부팅하면 휘발됨







# 차이점

두 가지 종류의 차이점 포인트

- 간단한지 복잡한지
- 호스트 컴퓨터에서 파일을 다룰 필요가 있는지
- 환경의 의존성을 배제해야 하는지



## 볼륨 마운트

- 도커 엔진 관리하에 있기 때문에 파일 위치를 신경 쓸 필요가 없음
- 운영체제에 따른 명령어 의존성 문제도 없음
    - 예) 경로 문제
        - 윈도우 -> 경로를 백슬레시(`\`)로 구분함
        - 리눅스/유닉스 -> 경로를 슬래시(`/`)`로 구분함
        - 사용자 환경에 따라 경로를 바꿔줘야하는 작업이 추가적으로 필요함
- 사용하기 쉬움 (도커 제작사 측에도 볼륨 마운트를 적극 사용하라 함)

---

- 하지만 볼륨 마운트는 도커 컨테이너를 경유하지 않으면 접근이 불가능하다
- 볼륨에 장애가 날 수도 있고, 백업하기도 복잡함



## 바인드 마운트

도커가 관리하지 않기 때문에 어느 경로, 어느 디렉토리라도 파일을 위치시킬 수 있음

기존과 동일한 방식으로 파일을 사용할 수 있고, 도커와는 별개로 파일을 관리할 수 있음

변경이 많은 경우 바인드 마운트가 유리함





| 항목          | 볼륨 마운트             | 바인드 마운트                    |
| ------------- | ----------------------- | -------------------------------- |
| 스토리지 영역 | 볼륨                    | 디렉토리 또는 파일               |
| 물리적 위치   | 도커 엔진의 관리 영역   | 어디든지 가능                    |
| 마운트 절차   | 볼륨을 생성한 후 마운트 | 기존 파일 또는 디렉토리에 마운트 |
| 내용 편집     | 도커 컨테이너를 통해    | 일반적인 파일과 같음             |
| 백업          | 절차가 복잡함           | 일반적인 파일과 같음             |







# 마운트

## 커맨드

run 커맨드의 옵션으로 지정한다.

마운트하려는 스토리지 경로와 컨테이너 속 특정 경로와 연결하도록 설정



마운트되는 스토리지는 본래 별도의 장소에 있지만 마치 컨테이너 안에 있는 것처럼 설정하는 것이다.

(심볼릭링크같은건가 봄)



## 절차

1. 마운트될 스토리지를 생성
2. 컨테이너를 생성
3. 마운트



## 방법

### 1. 볼륨 생성

- 바인드 마운트
    - 우선 스토리지로 쓰일 디렉토리나 파일을 먼저 만든다.
        로컬 머신에 그냥 만들면 끝




- 볼륨 마운트

    - 볼륨을 먼저 만든다.

    - 볼륨 생성 : `docker volume create 볼륨이름`

    - 볼륨 삭제 : `docker volume rm 볼륨이름`

    - 하위 커맨드

        | 커맨드  | 설명                            | 생략형 | 주요 옵션 |
        | ------- | ------------------------------- | ------ | --------- |
        | create  | 볼륨 생성                       | X      | 거의 안씀 |
        | inspect | 볼륨 상세 정보 출력             | X      | 거의 안씀 |
        | ls      | 볼륨 목록 출력                  | X      | 거의 안씀 |
        | prune   | 현재 마운트 안된 볼륨 모두 삭제 | X      | 거의 안씀 |
        | rm      | 지정한 볼륨 사겢                | X      | 거의 안씀 |

        


### 2. 마운트

`-v` 옵션을 사용해 연결해 준다.



- 바인드 마운트
    - `docker run (생략) -v 실제스토리지경로:컨테이너마운트경로 (생략)`



- 볼륨 마운트
    - `docker run (생략) -v 볼륨이름:컨테이너마운트경로 (생략)`







